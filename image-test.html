<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π - –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ–≤—Ä–æ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #0088cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #006699;
        }
        .result {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }
        .error {
            background: #ffeaea;
            border-left-color: #dc3545;
        }
        .image-preview {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        .console-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üñºÔ∏è –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</h1>
    
    <div class="test-container">
        <h2>–¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞</h2>
        <p>–°–æ–∑–¥–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏</p>
        <button class="test-button" onclick="testImageCreation()">–°–æ–∑–¥–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
        <div id="image-result" class="result" style="display: none;"></div>
        <img id="preview-image" class="image-preview" style="display: none;">
    </div>

    <div class="test-container">
        <h2>–¢–µ—Å—Ç 2: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞</h2>
        <p>–°–æ–∑–¥–∞–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞</p>
        <button class="test-button" onclick="testImageCopy()">–°–æ–∑–¥–∞—Ç—å –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <div id="copy-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-container">
        <h2>–¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞</h2>
        <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏</p>
        <button class="test-button" onclick="testBrowserSupport()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É</button>
        <div id="support-result" class="result" style="display: none;"></div>
    </div>

    <div class="test-container">
        <h2>–ö–æ–Ω—Å–æ–ª—å –æ—Ç–ª–∞–¥–∫–∏</h2>
        <div id="console-output" class="console-output"></div>
        <button class="test-button" onclick="clearConsole()">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å</button>
    </div>

    <div class="test-container">
        <h2>üîó –°—Å—ã–ª–∫–∏</h2>
        <a href="index.html" class="test-button" style="text-decoration: none; display: inline-block;">–û—Ç–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</a>
    </div>

    <script>
        // –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ–º console.log –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
        const originalLog = console.log;
        const originalError = console.error;
        
        function addToConsole(message, type = 'log') {
            const consoleOutput = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #666;">[${timestamp}]</span> <span style="color: ${type === 'error' ? 'red' : 'black'};">${message}</span>`;
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToConsole(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToConsole(args.join(' '), 'error');
        };

        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        const testData = {
            package: 'premium',
            pile: 'long',
            length: 2.5,
            width: 1.5,
            odorRemoval: true,
            orderNumber: 'TEST123'
        };

        const prices = {
            standard: { short: 10, long: 11 },
            premium: { short: 13, long: 15 }
        };

        function calculateTotalPrice() {
            const area = testData.length * testData.width;
            const pricePerSquareMeter = prices[testData.package][testData.pile];
            let totalPrice = area * pricePerSquareMeter;
            
            if (testData.odorRemoval) {
                totalPrice += 25;
            }
            
            return Math.round(totalPrice);
        }

        async function createResultImage() {
            return new Promise((resolve, reject) => {
                try {
                    // –°–æ–∑–¥–∞—ë–º canvas –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // –†–∞–∑–º–µ—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    const width = 400;
                    const height = 300;
                    canvas.width = width;
                    canvas.height = height;
                    
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–º—É
                    const isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                    
                    // –¶–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–º—ã
                    const bgColor = isDark ? '#2d2d2d' : '#ffffff';
                    const textColor = isDark ? '#ffffff' : '#000000';
                    const accentColor = '#0088cc';
                    const borderColor = isDark ? '#404040' : '#e9ecef';
                    
                    // –§–æ–Ω
                    ctx.fillStyle = bgColor;
                    ctx.fillRect(0, 0, width, height);
                    
                    // –†–∞–º–∫–∞
                    ctx.strokeStyle = borderColor;
                    ctx.lineWidth = 2;
                    ctx.strokeRect(10, 10, width - 20, height - 20);
                    
                    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
                    ctx.fillStyle = accentColor;
                    ctx.font = 'bold 24px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('üß© –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å—á—ë—Ç–∞', width / 2, 50);
                    
                    // –î–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                    const area = testData.length * testData.width;
                    const totalPrice = calculateTotalPrice();
                    
                    const packageNames = {
                        standard: '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π',
                        premium: '–ü—Ä–µ–º–∏—É–º'
                    };
                    
                    const pileNames = {
                        short: '–ö–æ—Ä–æ—Ç–∫–∏–π',
                        long: '–î–ª–∏–Ω–Ω—ã–π'
                    };
                    
                    const resultData = [
                        ['–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞:', testData.orderNumber || '–ù–µ —É–∫–∞–∑–∞–Ω'],
                        ['–ü–∞–∫–µ—Ç —É—Å–ª—É–≥:', packageNames[testData.package]],
                        ['–¢–∏–ø –≤–æ—Ä—Å–∞:', pileNames[testData.pile]],
                        ['–ü–ª–æ—â–∞–¥—å:', `${area.toFixed(1)} –º¬≤`],
                        ['–î–æ–ø.—É—Å–ª—É–≥–∞:', testData.odorRemoval ? '–£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∞—Ö–∞ ‚Äî –¥–∞' : '–ù–µ—Ç'],
                        ['–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:', `${totalPrice} —Ä—É–±–ª–µ–π`]
                    ];
                    
                    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                    ctx.fillStyle = textColor;
                    ctx.font = '16px Arial';
                    ctx.textAlign = 'left';
                    
                    let y = 90;
                    resultData.forEach(([label, value], index) => {
                        // –ú–µ—Ç–∫–∞
                        ctx.fillText(label, 30, y);
                        
                        // –ó–Ω–∞—á–µ–Ω–∏–µ
                        if (index === resultData.length - 1) {
                            // –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤—ã–¥–µ–ª—è–µ–º
                            ctx.fillStyle = accentColor;
                            ctx.font = 'bold 18px Arial';
                        }
                        ctx.fillText(value, 200, y);
                        
                        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ã—á–Ω—ã–π —Å—Ç–∏–ª—å
                        ctx.fillStyle = textColor;
                        ctx.font = '16px Arial';
                        
                        // –õ–∏–Ω–∏—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å
                        if (index < resultData.length - 1) {
                            ctx.strokeStyle = borderColor;
                            ctx.beginPath();
                            ctx.moveTo(30, y + 10);
                            ctx.lineTo(width - 30, y + 10);
                            ctx.stroke();
                        }
                        
                        y += 30;
                    });
                    
                    // –ü–æ–¥–ø–∏—Å—å –≤–Ω–∏–∑—É
                    ctx.fillStyle = textColor;
                    ctx.font = '12px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ–≤—Ä–æ–≤ - Telegram Mini App', width / 2, height - 20);
                    
                    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ blob
                    canvas.toBlob((blob) => {
                        if (blob) {
                            resolve(blob);
                        } else {
                            reject(new Error('Failed to create image blob'));
                        }
                    }, 'image/png');
                    
                } catch (error) {
                    reject(error);
                }
            });
        }

        function testImageCreation() {
            console.log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...');
            
            createResultImage().then((imageBlob) => {
                console.log('‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ');
                console.log('–†–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', imageBlob.size, '–±–∞–π—Ç');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const imageUrl = URL.createObjectURL(imageBlob);
                const previewImage = document.getElementById('preview-image');
                previewImage.src = imageUrl;
                previewImage.style.display = 'block';
                
                const result = document.getElementById('image-result');
                result.style.display = 'block';
                result.innerHTML = '‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ —É—Å–ø–µ—à–Ω–æ! –†–∞–∑–º–µ—Ä: ' + imageBlob.size + ' –±–∞–π—Ç';
                
            }).catch((error) => {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);
                const result = document.getElementById('image-result');
                result.style.display = 'block';
                result.className = 'result error';
                result.innerHTML = '‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ' + error.message;
            });
        }

        function testImageCopy() {
            console.log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...');
            
            createResultImage().then((imageBlob) => {
                if (navigator.clipboard && navigator.clipboard.write) {
                    navigator.clipboard.write([
                        new ClipboardItem({
                            'image/png': imageBlob
                        })
                    ]).then(() => {
                        console.log('‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
                        const result = document.getElementById('copy-result');
                        result.style.display = 'block';
                        result.innerHTML = '‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –≤ –ª—é–±–æ–π —á–∞—Ç (Ctrl+V).';
                    }).catch((error) => {
                        console.error('‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                        const result = document.getElementById('copy-result');
                        result.style.display = 'block';
                        result.className = 'result error';
                        result.innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: ' + error.message;
                    });
                } else {
                    console.log('‚ùå Clipboard API —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è');
                    const result = document.getElementById('copy-result');
                    result.style.display = 'block';
                    result.className = 'result error';
                    result.innerHTML = '‚ùå –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ —ç—Ç–æ–º –±—Ä–∞—É–∑–µ—Ä–µ';
                }
            }).catch((error) => {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                const result = document.getElementById('copy-result');
                result.style.display = 'block';
                result.className = 'result error';
                result.innerHTML = '‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ' + error.message;
            });
        }

        function testBrowserSupport() {
            console.log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±—Ä–∞—É–∑–µ—Ä–∞...');
            
            const support = {
                canvas: !!document.createElement('canvas').getContext,
                clipboard: !!navigator.clipboard,
                clipboardWrite: !!navigator.clipboard?.write,
                clipboardWriteText: !!navigator.clipboard?.writeText,
                fileAPI: !!window.File,
                blobAPI: !!window.Blob,
                urlAPI: !!window.URL
            };
            
            console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:', support);
            
            const result = document.getElementById('support-result');
            result.style.display = 'block';
            
            let html = '<h3>–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞:</h3><ul>';
            Object.entries(support).forEach(([feature, supported]) => {
                html += `<li>${feature}: ${supported ? '‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è' : '‚ùå –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è'}</li>`;
            });
            html += '</ul>';
            
            const allSupported = Object.values(support).every(Boolean);
            if (allSupported) {
                html += '<p style="color: green;">‚úÖ –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è!</p>';
            } else {
                html += '<p style="color: orange;">‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è</p>';
            }
            
            result.innerHTML = html;
        }

        function clearConsole() {
            document.getElementById('console-output').innerHTML = '';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        console.log('–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        console.log('–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:', testData);
    </script>
</body>
</html>
